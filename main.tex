\documentclass[%
  libro,          
  corpo=12pt,        % corpo normale 11pt
  tipotesi=custom % laurea triennale
]{toptesi}


\usepackage[T1]{fontenc}
% \usepackage[utf8]{inputenc} %ignored by luatex?
\usepackage{toptesi}
\usepackage{xcolor}

% \usepackage[printwatermark]{xwatermark}
% \newwatermark[allpages,color=red!30,angle=45,scale=3,xpos=0,ypos=0]{BOZZA}
\usepackage{tikz}
\AddToHook{shipout/background}{
       \begin{tikzpicture}[overlay, remember picture]
            \node[fill=yellow!30, draw, text=red!30, rotate=45, scale=5] at (current page) {BOZZA};
        \end{tikzpicture}    
    }

\begin{pdfxmetadata}
  \Title{Titolo}
  \Author{Alessandro Cerati}
  \Publisher{Alessandro Cerati}
  \Keywords{Monografia di laurea \sep
            Geometria simplettica}
\end{pdfxmetadata}

% \usepackage[a-1b]{pdfx}% oppure [a-2b]

\usepackage{fontspec}
\setmainfont[Ligatures=TeX]{LibertinusSerif}[
  Extension = .otf,
  UprightFont = *-Regular,
  BoldFont = *-Bold, 
  ItalicFont = *-Italic,
  BoldItalicFont = *-BoldItalic
]
% \setmainfont[Ligatures=TeX]{Comic Sans MS}
\setsansfont[Ligatures=TeX]{LibertinusSans}[
  Extension = .otf,
  UprightFont = *-Regular,
  BoldFont = *-Bold, 
  ItalicFont = *-Italic,
]
\setmonofont{NewCMMono10-Regular.otf}
\setmainlanguage[babelshorthands]{italian}

\usepackage{amsmath}
\usepackage{unicode-math}
\setmathfont{XITS Math}
\usepackage{physics}
\newcommand{\R}{\mathbb{R}}
\renewcommand{\vec}[1]{\boldsymbol{#1}}
\newcommand{\identity}{\mathcal{i}}
\newcommand{\e}{\mathrm{e}}
\newcommand{\defeq}{\equiv}
\newcommand{\transpose}{^{\mathrm{T}}}

\usepackage{amsthm}
\usepackage{thmtools, thm-restate}
\declaretheorem[
  style = plain,
  parent = chapter,
  name = Teorema,
  refname={teorema,teoremi},
  Refname={Teorema,Teoremi}]{theorem}
\declaretheorem[
  style = definition, 
  sibling = theorem, 
  name = Definizione,
  refname={definizione,definizioni},
  Refname={Definizione,Definizioni}]{definition}
\newcommand{\dfn}[1]{\emph{#1}}
\declaretheorem[
  style = remark,
  parent = theorem,
  name = Osservazione,
  refname={osservazione,osservazioni},
  Refname={Osservazione,Osservazioni}]{remark}

\declaretheorem[
  style = theorem,
  parent = theorem,
  name = Corollario,
  refname={corollario,corollari},
  Refname={Corollario,Corollari}]{corollary}

\declaretheorem[style = plain, numbered = no, name = Legge di Newton]{newton}
\declaretheorem[style = plain, numbered = no, name = Principio di minima azione]{minaction}

\declaretheorem[
  style = plain,
  parent = chapter,
  name = Esempio,
  refname={esempio,esempi},
  Refname={Esempio,Esempi}]{example}


\usepackage{epigraph}
\usepackage{graphicx}
\graphicspath{./graphics}

\usepackage[backend=biber, eprint = false]{biblatex} %bibliography support
\addbibresource{./bachelorThesis.bib}

\usepackage[italian=quotes]{csquotes}


\usepackage{hyperref} %autoloaded in xwatermark
\renewcommand{\equationautorefname}{equazione}
\renewcommand{\chapterautorefname}{capitolo}
\renewcommand{\sectionautorefname}{sezione}
\hypersetup{hidelinks}

\begin{document}
\renewcommand{\epsilon}{\varepsilon}
\renewcommand{\phi}{\varphi}

  \input{chapters/frontispice.tex}
  \newpage
  \pagenumbering{gobble}
  \tableofcontents
  \newpage
  \hspace{0pt}
  \vfill
  \epigraph{Per i mari azzurri degli atlanti e per i grandi mari del mondo.}{J. L. Borges, \textit{Storia della notte}}
  \vfill
  \hspace{0pt}
  \newpage
  \
  \newpage
  \pagenumbering{arabic}
  \input{chapters/introduction.tex}

  \input{chapters/classicalMechanics.tex}
  \input{chapters/manifolds.tex}
  \input{chapters/symplecticMechanics.tex}
  \input{chapters/marsden.tex}

  \nocite{*}
  \printbibliography[heading=bibintoc,
  title={Riferimenti bibliografici}]

  \input{chapters/thanks.tex}

\end{document}
\documentclass[%
  libro,          
  corpo=12pt,        % corpo normale 11pt
  tipotesi=custom, % laurea triennale
  draft
]{toptesi}

\usepackage[T1]{fontenc}
% \usepackage[utf8]{inputenc} %ignored by luatex?
\usepackage{toptesi}
\usepackage{xcolor}

% \usepackage[printwatermark]{xwatermark}
% \newwatermark[allpages,color=red!30,angle=45,scale=3,xpos=0,ypos=0]{BOZZA}
\usepackage{tikz}
\AddToHook{shipout/background}{
       \begin{tikzpicture}[overlay, remember picture]
            \node[fill=yellow!30, draw, text=red!30, rotate=45, scale=5] at (current page) {BOZZA};
        \end{tikzpicture}    
    }

\begin{pdfxmetadata}
  \Title{Titolo}
  \Author{Alessandro Cerati}
  \Publisher{Alessandro Cerati}
  \Keywords{Monografia di laurea \sep
            Geometria simplettica}
\end{pdfxmetadata}

% \usepackage[a-1b]{pdfx}% oppure [a-2b]

\usepackage{fontspec}
\setmainfont[Ligatures=TeX]{LibertinusSerif}[
  Extension = .otf,
  UprightFont = *-Regular,
  BoldFont = *-Bold, 
  ItalicFont = *-Italic,
  BoldItalicFont = *-BoldItalic
]
\setsansfont[Ligatures=TeX]{LibertinusSans}[
  Extension = .otf,
  UprightFont = *-Regular,
  BoldFont = *-Bold, 
  ItalicFont = *-Italic,
]
\setmonofont{NewCMMono10-Regular.otf}
\setmainlanguage[babelshorthands]{italian}

\usepackage{amsmath}
\usepackage{unicode-math}
\setmathfont{XITS Math}
\usepackage{physics}
\newcommand{\R}{\mathbb{R}}
\renewcommand{\vec}[1]{\boldsymbol{#1}}
\newcommand{\identity}{\mathcal{i}}
\newcommand{\defeq}{\equiv}

\usepackage{amsthm}
\usepackage{thmtools}
\declaretheorem[
  style = plain,
  parent = chapter,
  name = Teorema,
  refname={teorema,teoremi},
  Refname={Teorema,Teoremi}]{theorem}
\declaretheorem[
  style = definition, 
  sibling = theorem, 
  name = Definizione,
  refname={definizione,definizioni},
  Refname={Definizione,Definizioni}]{definition}
\newcommand{\dfn}[1]{\emph{#1}}
\declaretheorem[
  style = remark,
  parent = theorem,
  name = Osservazione,
  refname={osservazione,osservazioni},
  Refname={Osservazione,Osservazioni}]{remark}

\declaretheorem[style = plain, numbered = no, name = Legge di Newton]{newton}
\declaretheorem[style = plain, numbered = no, name = Principio di minima azione]{minaction}

\declaretheorem[
  style = plain,
  parent = chapter,
  name = Esempio,
  refname={esempio,esempi},
  Refname={Esempio,Esempi}]{example}

\usepackage{graphicx}
\graphicspath{./graphics}

\usepackage{hyperref} %autoloaded in xwatermark
\renewcommand{\equationautorefname}{equazione}
\renewcommand{\chapterautorefname}{capitolo}
\renewcommand{\sectionautorefname}{sezione}

\begin{document}
\renewcommand{\epsilon}{\varepsilon}
\renewcommand{\phi}{\varphi}

  % \input{chapters/frontispice.tex}
  % \input{chapters/introduction.tex}

  % \input{chapters/classicalMechanics.tex}
  \input{chapters/manifolds.tex}
  % \input{chapters/symplecticMechanics.tex}

\end{document}